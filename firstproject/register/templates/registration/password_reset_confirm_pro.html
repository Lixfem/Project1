<!-- templates/registration/password_reset_confirm_pro.html -->
{% extends "base.html" %}
{% block content %}
<h2>Nouveau mot de passe</h2>

{% if validlink %}
    <p id="timer">Temps restant : <strong>30:00</strong></p>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Changer mon mot de passe</button>
    </form>

    <script>
        let seconds = {{ time_left_seconds|default:1800 }};
        const timer = document.getElementById('timer');
        const form = document.querySelector('form');
        const interval = setInterval(() => {
            if (seconds <= 0) {
                timer.innerHTML = "<strong style='color:red;'>Lien expiré !</strong>";
                form.innerHTML = "<p><a href='{% url 'password_reset' %}'>Demander un nouveau lien</a></p>";
                clearInterval(interval);
                return;
            }
            const m = String(Math.floor(seconds / 60)).padStart(2, '0');
            const s = String(seconds % 60).padStart(2, '0');
            timer.innerHTML = `Temps restant : <strong>${m}:${s}</strong>`;
            seconds--;
        }, 1000);
    </script>
{% else %}
    <p style="color:red;">Ce lien est expiré ou invalide.</p>
    <a href="{% url 'password_reset' %}">Demander un nouveau lien</a>
{% endif %}
{% endblock %}