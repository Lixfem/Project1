{% extends 'facture/base.html' %}

{% block content %}
<style>
    .container {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 1200px;
        width: 100%;
        margin: 20px auto;
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
    }

    .tab {
        flex: 1;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        font-weight: 600;
        color: #6c757d;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
    }

    .tab:hover {
        background: #e9ecef;
    }

    .tab.active {
        color: #667eea;
        background: white;
        border-bottom-color: #667eea;
    }

    .form-container {
        padding: 40px;
    }

    .form-section {
        display: none;
    }

    .form-section.active {
        display: block;
        animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    .table th, .table td {
        padding: 12px;
        border: 1px solid #e9ecef;
        text-align: left;
    }

    .table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #333;
    }

    .table tr:hover {
        background: #f1f3f5;
    }

    .badge {
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge-primary {
        background: #667eea;
        color: white;
    }

    @media (max-width: 768px) {
        .form-container {
            padding: 25px;
        }

        .container {
            margin: 10px;
        }

        .table {
            font-size: 14px;
        }

       
    }
</style>

<div class="container">
    <div class="header">
        <h1>üõ†Ô∏è G√©rer les Articles</h1>
        <p class="mb-0">Visualisez et supprimez vos produits, services et cat√©gories</p>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('produit', this)">
            üì¶ Produits <span class="badge badge-primary">{{ produits.count }}</span>
        </div>
        <div class="tab" onclick="switchTab('service', this)">
            üõ†Ô∏è Services <span class="badge badge-primary">{{ services.count }}</span>
        </div>
        <div class="tab" onclick="switchTab('category', this)">
            üóÇÔ∏è Cat√©gories <span class="badge badge-primary">{{ categories.count }}</span>
        </div>
    </div>

    <div class="form-container">
        <!-- Affichage des messages -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %} me-2"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Section Produits -->
        <div class="form-section active" id="produit-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3><i class="fas fa-box me-2"></i>Liste des Produits</h3>
                <a href="{% url 'ajouter_element' %}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Ajouter un produit
                </a>
            </div>

            {% if produits %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Description</th>
                                <th>Quantit√©</th>
                                <th>Prix Unitaire</th>
                                <th>Total</th>
                                <th>Cat√©gorie</th>
                                <th class=>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for produit in produits %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><strong>{{ produit.nom_produit }}</strong></td>
                                    <td>{{ produit.description_produit|truncatewords:10|default:"‚Äî" }}</td>
                                    <td>{{ produit.quantity }}</td>
                                    <td>{{ produit.prix_unitaire_produit|floatformat:2 }} FCFA</td>
                                    <td><strong>{{ produit.get_total|floatformat:2 }} FCFA</strong></td>
                                    <td>
                                        {% if produit.category %}
                                            <span class="badge bg-info">{{ produit.category.nom }}</span>
                                        {% else %}
                                            <span class="text-muted">Aucune cat√©gorie/span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <a href="{% url 'update-article' %}?type_element=produit&id={{ produit.id }}" class="btn btn-primary btn-sm strectched-link" title="Modifier le produit"><i class="fas fa-edit me-1"></i>Modifier</a>
                                        <form method="POST" style="display:inline;" onsubmit="return confirm('Voulez-vous vraiment supprimer le produit \'{{ produit.nom_produit }}\' ?');">
                                            {% csrf_token %}
                                            <input type="hidden" name="type_element" value="produit">
                                            <input type="hidden" name="type_action" value="delete">
                                            <input type="hidden" name="id" value="{{ produit.id }}">
                                            <button type="submit" class="btn btn-danger btn-sm">
                                                <i class="fas fa-trash me-1"></i>Supprimer
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    Aucun produit trouv√©. 
                    <a href="{% url 'ajouter_element' %}" class="alert-link">Ajoutez-en un maintenant !</a>
                </div>
            {% endif %}
        </div>

        <!-- Section Services -->
        <div class="form-section" id="service-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3><i class="fas fa-concierge-bell me-2"></i>Liste des Services</h3>
                <a href="{% url 'ajouter_element' %}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Ajouter un service
                </a>
            </div>

            {% if services %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Description</th>
                                <th>Montant</th>
                                <th>Date de Prestation</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for service in services %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><strong>{{ service.nom_service }}</strong></td>
                                    <td>{{ service.description_service|truncatewords:10|default:"‚Äî" }}</td>
                                    <td><strong>{{ service.montant_du_service|floatformat:2 }} FCFA</strong></td>
                                    <td>
                                        {% if service.date_prestation_service %}
                                            {{ service.date_prestation_service|date:"d/m/Y" }}
                                        {% else %}
                                            <span class="text-muted">Non sp√©cifi√©e</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                       <a href="{% url 'update-article'%}?type_element=service&id={{ service.id|default_if_none:'' }}" class="btn btn-primary btn-sm strectched-link" title="Modifier le service"><i class="fas fa-edit me-1"></i>Modifier</a>
                                        <form method="POST" style="display:inline;" onsubmit="return confirm('Voulez-vous vraiment supprimer le service \'{{ service.nom_service }}\' ?');">
                                            {% csrf_token %}
                                            <input type="hidden" name="type_element" value="service">
                                            <input type="hidden" name="type_action" value="delete">
                                            <input type="hidden" name="id" value="{{ service.id }}">
                                            <button type="submit" class="btn btn-danger btn-sm">
                                                <i class="fas fa-trash me-1"></i>Supprimer
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    Aucun service trouv√©. 
                    <a href="{% url 'ajouter_element' %}" class="alert-link">Ajoutez-en un maintenant !</a>
                </div>
            {% endif %}
        </div>

        <!-- Section Cat√©gories -->
        <div class="form-section" id="category-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3><i class="fas fa-folder me-2"></i>Liste des Cat√©gories</h3>
                <a href="{% url 'ajouter_element' %}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Ajouter une cat√©gorie
                </a>
            </div>

            {% if categories %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nom</th>
                                <th>Description</th>
                                <th>Nb. de produits</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in categories %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td><strong>{{ category.nom }}</strong></td>
                                    <td>{{ category.description|truncatewords:15|default:"‚Äî" }}</td>
                                    <td>
                                        <span class="badge bg-secondary">
                                            {{ category.produit_set.count }} produit(s)
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <a href="{% url 'update-article'%}?type_element=category&id={{ category.id }}" class="btn btn-primary btn-sm strectched-link" title="Modifier la cat√©gorie"><i class="fas fa-edit me-1"></i>Modifier</a>
                                        <form method="POST" style="display:inline;" onsubmit="return confirm('Voulez-vous vraiment supprimer la cat√©gorie \'{{ category.nom }}\' ?\n\nAttention: Les produits associ√©s ne seront pas supprim√©s.');">
                                            {% csrf_token %}
                                            <input type="hidden" name="type_element" value="category">
                                            <input type="hidden" name="type_action" value="delete">
                                            <input type="hidden" name="id" value="{{ category.id }}">
                                            <button type="submit" class="btn btn-danger btn-sm">
                                                <i class="fas fa-trash me-1"></i>Supprimer
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    Aucune cat√©gorie trouv√©e. 
                    <a href="{% url 'ajouter_element' %}" class="alert-link">Ajoutez-en une maintenant !</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function switchTab(type, element) {
        // D√©sactiver tous les onglets
        const tabs = document.querySelectorAll('.tab');
        const sections = document.querySelectorAll('.form-section');
        
        tabs.forEach(tab => tab.classList.remove('active'));
        sections.forEach(section => section.classList.remove('active'));
        
        // Activer l'onglet et la section s√©lectionn√©s
        element.classList.add('active');
        document.getElementById(type + '-section').classList.add('active');
    }
</script>

{% endblock %}